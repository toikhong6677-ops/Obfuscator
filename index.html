<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tr√¨nh Gi·∫£i M√£ LuaObfuscator (Fixed v2)</title>
    <style>
        body { font-family: 'Consolas', monospace; background: #0d1117; color: #c9d1d9; padding: 20px; line-height: 1.5; }
        .container { max-width: 1100px; margin: 0 auto; background: #161b22; padding: 25px; border-radius: 12px; border: 1px solid #30363d; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: #58a6ff; text-align: center; margin-bottom: 5px; text-transform: uppercase; }
        p.subtitle { text-align: center; color: #8b949e; margin-top: 0; margin-bottom: 20px; font-size: 14px; }
        textarea { width: 100%; height: 280px; background: #010409; color: #7ee787; border: 1px solid #30363d; padding: 15px; border-radius: 8px; box-sizing: border-box; font-size: 12px; resize: vertical; outline: none; }
        textarea:focus { border-color: #58a6ff; }
        button { display: block; width: 100%; background: #238636; color: white; border: none; padding: 18px; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 8px; margin-top: 15px; transition: 0.3s; text-transform: uppercase; }
        button:hover { background: #2ea043; transform: translateY(-2px); }
        .result-box { margin-top: 25px; display: none; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .box-title { font-weight: bold; color: #79c0ff; margin-bottom: 10px; border-bottom: 1px solid #30363d; padding-bottom: 5px; display: flex; justify-content: space-between; }
        .output { background: #0d1117; border: 1px solid #30363d; padding: 15px; border-radius: 8px; white-space: pre-wrap; word-break: break-all; min-height: 120px; max-height: 400px; overflow-y: auto; font-size: 13px; color: #e6edf3; }
        .pseudo-code { background: #1c2128; border-left: 4px solid #f0883e; color: #adbac7; }
        .highlight-blue { color: #58a6ff; font-weight: bold; }
        .highlight-green { color: #3fb950; }
        .tag { font-size: 10px; background: #30363d; padding: 2px 6px; border-radius: 4px; color: #8b949e; }
    </style>
</head>
<body>

<div class="container">
    <h2>REVERSE ENGINEER TOOLBOX</h2>
    <p class="subtitle">Ch·∫ø ƒë·ªô gi·∫£i m√£: Bytecode Stream + Flag 'Q' Handler</p>
    
    <textarea id="inputCode" placeholder="D√°n FULL code Lua (c√≥ ch·ª©a LOL!...) v√†o ƒë√¢y..."></textarea>
    <button onclick="crackFullObfuscator()">‚ö° B·∫Øt ƒë·∫ßu gi·∫£i m√£ & Ph√¢n t√≠ch h·ªá th·ªëng</button>

    <div id="resultArea" class="result-box">
        <div class="box-title">
            <span>üî• PH√ÇN T√çCH LU·ªíNG (Pseudo-code)</span>
            <span class="tag">AI Logic</span>
        </div>
        <div id="pseudoOutput" class="output pseudo-code"></div>
        <br>
        <div class="grid">
            <div>
                <div class="box-title">üåê URL / WEBHOOK / API:</div>
                <div id="urlOutput" class="output highlight-blue"></div>
            </div>
            <div>
                <div class="box-title">üìù D·ªÆ LI·ªÜU CHU·ªñI TR√çCH XU·∫§T:</div>
                <div id="textOutput" class="output highlight-green"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function crackFullObfuscator() {
        let input = document.getElementById('inputCode').value;
        if (!input) return alert("Vui l√≤ng d√°n code v√†o!");

        // 1. D·ªåN D·∫∏P COMMENT
        input = input.replace(/--\[\[[\s\S]*?\]\]--/g, ''); 
        input = input.replace(/--[^\n]*/g, ''); 

        // 2. REGEX M·ªöI: Nh·∫≠n di·ªán m·ªçi k√Ω t·ª± trong LOL! (bao g·ªìm Q, O, r√°c...)
        const regex = /["'](LOL![^"']+)["']/;
        const match = input.match(regex);
        
        if (!match) {
            return alert("L·ªói: Kh√¥ng t√¨m th·∫•y v√πng nh·ªõ LOL!. H√£y ch·∫Øc ch·∫Øn b·∫°n ƒë√£ d√°n ƒë√∫ng ƒë·ªãnh d·∫°ng.");
        }

        let payload = match[1].substring(4); // B·ªè ch·ªØ LOL!
        let binaryResult = [];
        let repeatCount = null;

        // 3. THU·∫¨T TO√ÅN GI·∫¢I M√É N√ÇNG CAO (X·ª≠ l√Ω Flag Q v√† Byte-stream)
        for (let i = 0; i < payload.length; i++) {
            let char = payload[i];

            // N·∫øu g·∫∑p Flag 'Q' (ASCII 81) -> K√Ω t·ª± tr∆∞·ªõc ƒë√≥ l√† s·ªë l·∫ßn l·∫∑p
            if (char === 'Q') {
                let prevDigit = payload[i-1];
                if (/[0-9]/.test(prevDigit)) {
                    repeatCount = parseInt(prevDigit, 10);
                }
                continue;
            }

            // Ki·ªÉm tra c·∫∑p Hex (V√≠ d·ª•: 0D, 3C, FF)
            if (i + 1 < payload.length) {
                let pair = payload.substring(i, i + 2);
                if (/[0-9A-Fa-f]{2}/.test(pair)) {
                    let byte = parseInt(pair, 16);
                    
                    if (repeatCount !== null) {
                        // N·∫øu c√≥ flag l·∫∑p, th√™m byte n√†y N l·∫ßn
                        for(let j = 0; j < repeatCount - 1; j++) { 
                            binaryResult.push(byte);
                        }
                        repeatCount = null;
                    } else {
                        binaryResult.push(byte);
                    }
                    i++; // Nh·∫£y qua k√Ω t·ª± th·ª© 2 c·ªßa c·∫∑p Hex
                    continue;
                }
            }
        }

        // 4. TR√çCH XU·∫§T CHU·ªñI T·ª™ BYTE-STREAM
        let extractedStrings = [];
        let currentString = "";

        for (let i = 0; i < binaryResult.length; i++) {
            let code = binaryResult[i];
            // Ch·ªâ l·∫•y c√°c k√Ω t·ª± in ra ƒë∆∞·ª£c (ASCII 32-126)
            if (code >= 32 && code <= 126) {
                currentString += String.fromCharCode(code);
            } else {
                if (currentString.length >= 3) {
                    extractedStrings.push(currentString);
                }
                currentString = "";
            }
        }
        if (currentString.length >= 3) extractedStrings.push(currentString);

        // 5. PH√ÇN LO·∫†I D·ªÆ LI·ªÜU
        let foundUrls = [];
        let normalStrings = [];
        let pseudoCode = "";

        extractedStrings.forEach(str => {
            if (/https?:\/\/[^\s]+/.test(str)) {
                foundUrls.push(str);
            } else if (str.length > 3) {
                normalStrings.push(str);
            }
        });

        // 6. T√ÅI T·∫†O LOGIC D·ª∞A TR√äN T·ª™ KH√ìA (AI Heuristic)
        let allWords = extractedStrings.join(" ").toLowerCase();
        
        if (allWords.includes("httpget") || allWords.includes("request")) {
            pseudoCode += `-- [PH√ÇN T√çCH]: Script n√†y l√† m·ªôt LOADER (T·∫£i code t·ª´ xa).\n`;
            if(foundUrls.length > 0) {
                pseudoCode += `local targetURL = "${foundUrls[0]}"\n`;
                pseudoCode += `game:HttpGet(targetURL) -- T·∫£i v√† th·ª±c thi script ch√≠nh t·ª´ ƒë√¢y\n`;
            }
        } else if (allWords.includes("webhook") || allWords.includes("discord")) {
            pseudoCode += `-- [PH√ÇN T√çCH]: Script c√≥ h√†nh vi g·ª≠i d·ªØ li·ªáu (Log/Stealer) v·ªÅ Discord.\n`;
        } else {
            pseudoCode += `-- [PH√ÇN T√çCH]: Bytecode ch·ª©a c√°c h·∫±ng s·ªë c·ª•c b·ªô.\n`;
            pseudoCode += `-- C√≥ th·ªÉ l√† script ch·ª©c nƒÉng (Auto Farm, ESP, GUI).\n`;
        }
        
        pseudoCode += `\n-- Danh s√°ch c√°c h√†m/bi·∫øn ph√°t hi·ªán ƒë∆∞·ª£c:\n`;
        let functions = normalStrings.filter(s => s.length < 20).slice(0, 10);
        functions.forEach(f => pseudoCode += `function ${f.replace(/[^a-zA-Z]/g, '')}()\n`);

        // 7. HI·ªÇN TH·ªä K·∫æT QU·∫¢
        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('pseudoOutput').innerText = pseudoCode;
        document.getElementById('urlOutput').innerText = foundUrls.length > 0 ? foundUrls.join("\n") : "Kh√¥ng t√¨m th·∫•y URL k·∫øt n·ªëi.";
        document.getElementById('textOutput').innerText = normalStrings.length > 0 ? normalStrings.join("\n") : "D·ªØ li·ªáu bytecode qu√° n√°t, kh√¥ng th·ªÉ l·ªçc chu·ªói s·∫°ch.";
    }
</script>

</body>
</html>
